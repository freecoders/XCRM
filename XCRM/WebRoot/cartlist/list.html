<script>
	$(function() {
		$('.create.btn.btn-primary').on('click', function() {
			location.href = '/search/';
		});
		$('.del-item').on('click', function() {
			var that = $(this);
			var id = that.attr('data');
			$.ajax({
				type : "get",
				url : '/cartlist/remove?id=' + id,
				success : function(data, status) {
					if (status == "success") {
						that.parents('tr').empty();
						calc_amount();
					}
				}
			});
		});
		
		var calc_amount = function() {
			var amount = 0;
			for (var i = 0; i < $('.sum').length; i++) {
				amount += parseInt($($('.sum')[i]).html());
			}
			$('.amount').html(amount);
			var discount =$('#discount').val();
			if(discount<=0 || discount > 100){
				showAlert("输入的折扣值不能大于100小于0!!!");
				$('#discount').val(100);
				$('#price').val(amount*100/100);
				return;
			}
			if(!discount) discount = 100;
			$('#price').val(amount*discount/100);
		};
		
		$("#discount").on('input',function(e){  
			calc_amount();
		});  
		
		calc_amount();
	});
</script>

<table class="table table-striped table-hover" data-show-refresh="true"
	data-show-columns="true" data-search="true"
	data-query-params="queryParams" data-toolbar=".toolbar"
	data-pagination="true" data-show-toggle="true">
	<thead>
		<tr>
			<th data-field="name">图片</th>
			<th data-field="name">产品名称</th>
			<th data-field="city">数量</th>
			<th data-field="name">价格</th>
			<th data-field="name">小计</th>
			<th data-field="action" data-align="center"
				data-formatter="actionFormatter" data-events="actionEvents">操作</th>
			<#list list as item>
		<tr>
			<input type="hidden" value="${item.id}" class="itemid" />
			<td><img width="80px" height="80px"
				src='${(item.filename??)?string((prdimg_path+"/"+item.pid+"/"+((item.filename!"")?split(","))[0]),"/img/placehold.jpg")}' />
			</td>
			<td>${item.name}</td>
			<td>${item.num}</td>
			<td>${item.price}</td>
			<td class="sum">${item.price*item.num}</td>
			<td><a class="del-item" data="${item.id}"
				href="javascript:void(0);">删除</a></td>
		</tr>
		<tr>
		 <td>
		 </td>
		  <td colspan="5">
			  <div>
			    <label class="required">备注</label>
			    <textarea placeholder="请添加订单项说明" name="comments-${item.id}" value="${item.comments!'请添加订单项备注'}" class="form-control"  rows="2"></textarea>
		    </div>
	    </td>
		</tr>
		</#list>
		</tr>
	</thead>
</table>
<div class="col-md-12"
	style="text-align: left; padding: 10px; height: 70px; border-top: 1px solid #ddd">
	<div class="col-md-1"
		style="float: right; font-size: 18px; background-color: #df3033; text-align: center;">
		<a id="payment" class="sc-btn">去结算</a>
	</div>
	<div class="col-md-2" style="float: right; text-align: right; font-weight: bold">
		<span>总价:</span>
		<span class="amount"	style="color: #df3033; font-size: 18px"></span>
	  <br/>
	  <label>成交价: </label>
	  <input type="text" class="form-control" id="price"/>
	</div>
	 <div class="col-md-2" style="float: left;  font-weight: bold">
    <span>输入折扣(百分比):</span>
    <input type="number" class="form-control" id="discount" value="100" min="1" max="100"/>
  </div>

</div>