<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>订单客户管理系统</title>
<!-- css -->
<link rel="stylesheet" href="../../css/bootstrap.min.css" >
<link rel="stylesheet" href="../../css/bootstrap-theme.min.css" >
<link rel="stylesheet" href="../../css/layoutit.css" >
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.css">
<!-- js -->
<script src="../../js/jquery-3.1.1.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/locale/bootstrap-table-zh-CN.min.js"></script>
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="span12">

				<div class="navbar navbar-inverse" role="navigation">
						<div class="container-fluid">
						    <div class="navbar-header">
					        <a class="navbar-brand" href="#"><span class="glyphicon glyphicon-fire" aria-hidden="true"></span>订单管理系统</a>
					    </div>
					    <ul class="nav navbar-nav">
                  <li class="active"><a href="/user/index">用户管理</a></li>
                  <li class="active"><a href="/customer/index">客户管理</a></li>
                  <li><a href="#">产品管理</a></li>
                  <li><a href="#">库存管理</a></li>
                  <li><a href="#">预约管理</a></li>
              </ul>
              <ul class="nav navbar-nav navbar-right">
                  <li><a href="#">用户XX</a></li>
                  <li class="active"><a href="/logout">注销</a></li>
              </ul>
						</div>
				</div>

				<div class="page-header">
					<h1><span class="label label-primary">创建或修改用户相关信息</span></h1>
				</div>

				<p class="toolbar">
					<a class="create btn btn-primary" href="javascript:">创建</a> <span
						class="alert"></span>
				</p>
				<table id="table" class="table table-hover" data-show-refresh="true"
					data-show-columns="true" data-search="true"
					data-query-params="queryParams" data-toolbar=".toolbar"
					data-pagination="true" data-show-toggle="true"
					data-show-toggle="true">
					<thead>
						<tr>
							<th data-field="username">用户名</th>
							<th data-field="nickname">姓名</th>
							<th data-field="title">职位</th>
							<th data-field="department">部门</th>
							<th data-field="action" data-align="center"
								data-formatter="actionFormatter" data-events="actionEvents">操作</th>
						</tr>
					</thead>
				</table>

				<address>
					<strong>西安 活跃网络.</strong><br /> 795 Folsom Ave, Suite 600<br />
					San Francisco, CA 94107<br /> <abbr title="Phone">P:</abbr> (123)
					456-7890
				</address>
			</div>
		</div>
	</div>
	
	<div id="modal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title"></h4>
				</div>
				<div class="modal-body">
					<div class="form-group hidden">
						<label>ID</label> <input type="text" class="form-control"
							name="id" placeholder="id">
					</div>
					<div class="form-group">
						<label>用户名</label> <input type="text" class="form-control"
							name="username" placeholder="用户名">
					</div>
					<div class="form-group">
						<label>姓名</label> <input type="text" class="form-control"
							name="nickname" placeholder="名字">
					</div>
					<div class="form-group">
						<label>部门</label> <input type="text" class="form-control"
							name="department" placeholder="部门">
					</div>
					<div class="form-group">
						<label>职位</label> <input type="text" class="form-control"
							name="title" placeholder="职位">
					</div>

					<div class="form-group">
						<label>密码</label> <input type="password" class="form-control"
							name="password" placeholder="password">
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary submit">提交</button>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>
	<!-- /.modal -->
	<script>
		var API_URL = 'http://' + location.host + '/user/listusers/';
		var ADD_API_URL = 'http://' + location.host + '/user/save/';
		var UPDATE_API_URL = 'http://' + location.host + '/user/update/';
		var REMOVE_API_URL = 'http://' + location.host + '/user/remove/';
		var $table = $('#table').bootstrapTable({
			url : API_URL
		}), 
		$modal = $('#modal').modal({
			show : false
		}), 
		$alert = $('.alert').hide();
		$(function() {
			$('.create').click(function() {
				showModal($(this).text());
			});
			$modal.find('.submit').click(
					function() {
						var row = {};
						$modal.find('input[name]').each(function() {
							row[$(this).attr('name')] = $(this).val();
						});
						$.ajax({
							url : $modal.data('id') == "" ? ADD_API_URL : UPDATE_API_URL,
							type : 'post',
							data : row,
							success : function() {
								$modal.modal('hide');
								$table.bootstrapTable('refresh');
								showAlert(($modal.data('id') ? 'Update' : 'Create') + ' item successful!', 'success');
							},
							error : function() {
								$modal.modal('hide');
								showAlert(($modal.data('id') ? 'Update': 'Create') + ' item error!', 'danger');
							}
						});
					});
		});
		function queryParams(params) {
			return {};
		}
		function actionFormatter(value) {
			return [ '<a class="update" href="javascript:" title="编辑">编辑</a>',
					'<a class="remove" href="javascript:" title="删除">删除</a>', ]
					.join('   ');
		}
		// update and delete events
		window.actionEvents = {
			'click .update' : function(e, value, row) {
				showModal($(this).attr('title'), row);
			},
			'click .remove' : function(e, value, row) {
				if (confirm('Are you sure to delete this item?')) {
					$.ajax({
						url : REMOVE_API_URL + row.id,
						type : 'delete',
						success : function() {
							$table.bootstrapTable('refresh');
							showAlert('Delete item successful!', 'success');
						},
						error : function() {
							showAlert('Delete item error!', 'danger');
						}
					})
				}
			}
		};
		function showModal(title, row) {
			row = row || {
				id : '',
				nickname : '',
				department : 'yes',
				title : 'CEO',
				description : ''
			}; // default row value
			$modal.data('id', row.id);
			$modal.find('.modal-title').text(title);
			for ( var name in row) {
				$modal.find('input[name="' + name + '"]').val(row[name]);
			}
			$modal.modal('show');
		}
		function showAlert(title, type) {
			$alert.attr('class', 'alert alert-' + type || 'success').html(
					'<i class="glyphicon glyphicon-check"></i> ' + title)
					.show();
			setTimeout(function() {
				$alert.hide();
			}, 3000);
		}
	</script>

</body>
</html>
